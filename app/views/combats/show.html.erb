<h1><%= combat.encounter.name %></h1>

<div class="container">

  <div class="table-responsive bordered">
    <table id="combatant_table" class="table table-hover table-condensed">
      <caption>Order</caption>
      <thead>
        <tr>
          <td>Initiative</td>
          <td>Name</td>
          <td>Hit Points</td>
          <td>Armor Class</td>
        </tr>
      </thead>
      <tbody>
      <% combat.combatants.each do |combatant| %>
        <% id = "#{combatant.class.name.downcase}_#{combatant.id}" %>
        <tr id="<%= combatant.name %>">
          <th scope="row"><a href="#" name="<%= id %>_initiative" data-type="text" data-title="Enter initiative"><%= combatant.initiative %></a></th>
          <td><%= combatant.name %></td>
          <td><a href="#" name="<%= id %>_current_hit_points" data-type="text" data-title="Enter hit points"><%= combatant.current_hit_points %></a></td>
          <td><%= combatant.armor_class %></td>
        </tr>
      <% end %>
      </tbody>
    </table>
  </div>
</div>

<%= bootstrap_form_for combat, remote: true, html: { id: "combat_form" } do |f| %>
  <%= f.fields_for :encounter do |encounter_form| %>
    <%= encounter_form.hidden_field :name %>
    <%= encounter_form.hidden_field :experience_points %>
    <%= encounter_form.hidden_field :challenge_rating %>
  <% end %>
  <%= f.fields_for :enemies do |enemy_form| %>
    <%= enemy_form.hidden_field :id %>
    <%= enemy_form.hidden_field :name %>
    <%= enemy_form.hidden_field :hit_points %>
    <%= enemy_form.hidden_field :armor_class %>
    <%= enemy_form.hidden_field :initiative_bonus %>
    <%= enemy_form.hidden_field :current_hit_points, id: "enemy_#{enemy_form.object.id}_current_hit_points_field" %>
    <%= enemy_form.hidden_field :initiative, id: "enemy_#{enemy_form.object.id}_initiative_field" %>
  <% end %>
  <%= f.fields_for :characters do |character_form| %>
    <%= character_form.hidden_field :id %>
    <%= character_form.hidden_field :name %>
    <%= character_form.hidden_field :hit_points %>
    <%= character_form.hidden_field :armor_class %>
    <%= character_form.hidden_field :current_hit_points, id: "character_#{character_form.object.id}_current_hit_points_field" %>
    <%= character_form.hidden_field :initiative, id: "character_#{character_form.object.id}_initiative_field" %>
  <% end %>
  <%= f.submit 'Save', id: "save_btn" %>
<% end %>

<%= javascript_tag do %>

$(document).ready(function() {
  $("#combat_form").on("ajax:success", function(e, data, status, xhr){
    console.log(xhr.responseText)
  }).on("ajax:error", function(e, xhr, status, error){
    console.log(xhr.responseText)
  });

});

<% end %>
